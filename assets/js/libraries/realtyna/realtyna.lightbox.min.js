/*
 @preserve Realtyna Lightbox Plugin
 @Author Steve M. @ Realtyna UI Department
 @Copyright 2015 Realtyna Inc.
 */
(function($,window,document,undefined){"use strict";$._realtyna.fn.lightbox=function(){var defaults={minWidth:200,minHeight:130,maxWidth:9999,maxHeight:9999,width:800,height:500,title:"",autoSize:true,zIndex:99999,position:"center",showLoading:true,reloadPage:false,clearContent:true,loading:{color:"#000"},addTo:"body",overlayClass:"",wrapperClass:"",contentClass:"",closeClass:"",ajaxType:"POST",ajaxDataType:"html",ajaxData:undefined,ajaxURL:undefined,cssClasses:{lock:"realtyna-lightbox-lock",overlay:"realtyna-lightbox-overlay",wrap:"realtyna-lightbox-wp",title:"realtyna-lightbox-title",content:"realtyna-lightbox-cnt",close:"realtyna-lightbox-close-btn",error:"realtyna-lightbox-error",ajax:"realtyna-lightbox-ajax",placeholder:"realtyna-lightbox-placeholder",textOnlyWrap:"realtyna-lightbox-text-wrap",textOnlyContainer:"realtyna-lightbox-text-cnt",rightPos:"realtyna-lightbox-right-pos"},effects:{fadeIn:"wpl-fx-fadeIn",fadeOut:"wpl-fx-fadeOut",showOverlay:"wpl-fx-fadeIn",showBox:"wpl-fx-fadeInBottom",hideBox:"wpl-fx-fadeOutBottom"},errors:{notFound:"Selected content not found!",unexpected:"An unexpected error happen. Please try again."},callbacks:{beforeOpen:null,afterOpen:null,afterShow:null,afterClose:null}};var self=this,elements=null,R=Realtyna,opts={},classes=null,fx=null,placeholder=null,isOpen=false,isOpened=false,isLoading=false,overlay=null,wrap=null,close=null,content=null,loader=null,current=null,inner=null,error=null,href=null,watcher=null,type="inline",IDs={overlay:"realtyna-js-lightbox-overlay",wrap:"realtyna-js-lightbox-wrapper",content:"realtyna-js-lightbox-content",closeBtn:"realtyna-js-lightbox-close"};var L=$._realtyna.lightbox.fn={};L._beforeOpen=[];L._afterOpen=[];L._afterShow=[];L._afterClose=[];L.open=function(obj){isLoading=true;opts=obj.data("realtyna-lightbox-obj-opts");classes=opts.cssClasses;fx=opts.effects;placeholder=classes.placeholder;var inlineOpts=L.getInlineOptions(obj.attr("data-realtyna-lightbox-opts"));opts=$.extend({},opts,inlineOpts);_buildLayout(function(){type=_getType(obj);switch(type){case"inline":_renderInline(obj);break;case"ajax":_renderURL(obj);break;default:return false}})};L.trigger=function(name){var callbacks=opts.callbacks,evProp=L["_"+name];if(callbacks.hasOwnProperty(name)&&callbacks[name]!==null){evProp.unshift(callbacks[name])}for(var i=0;i<evProp.length;++i){evProp[i].call()}return true};L.getInlineOptions=function(options){if(!options)return false;return R.options2JSON(options)};L._error=function(err){inner=$("<div/>").text(err).addClass(classes.error);inner.invisible().appendTo(content);isOpen=true;L.trigger("beforeOpen");_resetView();wrap.unbind("onShow").bind("onShow",function(){inner.visible().hide().fadeIn();R.ajaxLoader.hide(loader);L.trigger("afterShow");isLoading=false;isOpened=true})};function _buildLayout(callback){$("html").addClass(classes.lock);overlay=$("<div />").attr("id",IDs.overlay).addClass(R.getClass(classes.overlay,opts.overlayClass)).css({zIndex:opts.zIndex});wrap=$("<div />").attr("id",IDs.wrap).addClass(R.getClass(classes.wrap,opts.wrapperClass));wrap.appendTo(overlay).addClass(opts.position=="center"?fx.showBox:classes.rightPos);close=$("<div />").attr("id",IDs.closeBtn).addClass(R.getClass(classes.close,opts.closeClass));close.hide().appendTo(wrap);content=$("<div />").attr("id",IDs.content).addClass(R.getClass(classes.content,opts.contentClass));content.appendTo(wrap);overlay.appendTo(opts.addTo);_EventsOn();L.trigger("beforeOpen");_resetView();if(opts.showLoading){loader=R.ajaxLoader.show(wrap,"normal","center",false,opts.loading.color)}callback.call()}function _resetView(){var viewport=R.getBrowserSizes().browser(),left,top,height,width;if(isOpen){var oldPos=inner.css("position");inner.css({position:"absolute"});if(opts.autoSize){width=inner.not("script, style").eq(0).outerWidth();height=inner.not("script, style").eq(0).outerHeight()}else{width=opts.width;height=opts.height}inner.css({position:oldPos==="static"?"":oldPos});if(opts.position=="center"){width=Math.min(width+2,opts.maxWidth);height=Math.min(height+2,opts.maxHeight);width=Math.max(width,opts.minWidth);height=Math.max(height,opts.minHeight);left=viewport.width/2-width/2;top=Math.max(viewport.height/2-height/2,40);if(!isOpened){wrap.animate({left:left,top:top,width:width,height:height},450);setTimeout(function(){if(height>opts.minHeight)height=opts.autoSize?"auto":height;wrap.css({height:height});overlay.css({overflowY:"auto"});wrap.trigger("onShow");L.trigger("afterOpen")},600)}else{wrap.css({height:opts.autoSize?"auto":height,left:left,top:top,width:width})}}else if(opts.position=="right"){wrap.css({left:"100%",top:0,height:"100%",width:width}).animate({marginLeft:"-"+width},450);setTimeout(function(){wrap.trigger("onShow");L.trigger("afterOpen")},600)}}else{if(opts.position=="center"){wrap.css({width:100,height:100,left:viewport.width/2-50,top:viewport.height/2-50})}else if(opts.position=="right"){wrap.css({width:100,height:"100%",left:"100%",top:0}).animate({marginLeft:-100},100)}}return true}function _getType(elm){var _href;if(typeof elm.attr("href")!="undefined"){_href=elm.attr("href")}else if(typeof elm.attr("data-realtyna-href")!="undefined"){_href=elm.attr("data-realtyna-href")}else{$._realtyna.lightbox.close()}if(_href.length>0){if(_href[0]=="#"){return"inline"}else{return"ajax"}}}function _EventsOn(){$(overlay).on("click.realtyna-lightbox",function(evn){var _self=$(evn.target);if(!_self.hasClass(classes.wrap)&&_self.parents("."+classes.wrap).length==0)self.close()});$(close).on("click.realtyna-lightbox",function(evn){evn.preventDefault();self.close()});$(window).on("resize.realtyna-lightbox",function(){window.resizeEvt;$(window).on("resize.realtyna-lightbox",function(){clearTimeout(window.resizeEvt);window.resizeEvt=setTimeout(function(){_resetView()},250)})});$(document).on("keydown.realtyna-lightbox",function(e){if((e.which||e.keyCode)===27){e.preventDefault();self.close()}})}function _EventsOff(){$(window).off("resize.realtyna-lightbox");$(document).off("keydown.realtyna-lightbox")}function _renderInline(elm){var rxURL=/^#[a-z]+[\w-]*$/gi;href=elm.attr("href")||elm.attr("data-realtyna-href");if(!rxURL.test(href))return;current=$(href);if(current.length===0){L._error(opts.errors.notFound);return}if(!current.data(placeholder))current.data(placeholder,$('<div class="'+placeholder+'"></div>').insertAfter(current).hide());current=current.show().invisible().detach();isOpen=true;$(content).append(current);wrap.bind("onReset",function(){if($(this).find(current).length){if(opts.autoSize)wrap.height(current.outerHeight());current.hide().replaceAll(current.data(placeholder)).data(placeholder,false);if(opts.clearContent)current.html("")}});wrap.bind("onShow",function(){current.visible().hide().fadeIn();close.fadeIn();R.ajaxLoader.hide(loader);isLoading=false;isOpened=true;L.trigger("afterShow")});watcher=setInterval(function(){if(current.html().length>0){clearInterval(watcher);if(current.children().length==0){current.wrapInner('<div class="'+opts.cssClasses.textOnlyContainer+'"/>');current.prepend('<h2 class="'+opts.cssClasses.title+'">'+opts.title+"</h2>");current.wrapInner('<div class="'+opts.cssClasses.textOnlyWrap+'"/>')}if(current.find("."+opts.cssClasses.title).length!=0&&current.find("."+opts.cssClasses.textOnlyContainer).length==0){current.wrapInner('<div class="'+opts.cssClasses.textOnlyContainer+'"/>')}if(current.find("."+opts.cssClasses.title).length==0&&current.find("h2").length==0){current.prepend('<h2 class="'+opts.cssClasses.title+'">'+opts.title+"</h2>")}if(current.find("."+opts.cssClasses.textOnlyWrap).length==0){current.wrapInner('<div class="'+opts.cssClasses.textOnlyWrap+'"/>')}inner=current.children();_resetView()}},300)}function _renderURL(elm){var data=elm.attr("data-realtyna-lightbox-data")||{};if(typeof opts.ajaxData!="undefined")data=opts.ajaxData;href=elm.attr("href")||elm.attr("data-realtyna-href");if(typeof opts.ajaxURL!="undefined")href=opts.ajaxURL;$.ajax({type:opts.ajaxType,dataType:opts.ajaxDataType,url:href,data:data,error:function(jqXHR,textStatus){L._error(opts.errors.unexpected)},success:function(data,textStatus){if(textStatus==="success"){current=$("<div/>").addClass(classes.ajax).html(data);inner=current.children();isOpen=true;L.trigger("beforeOpen");content.append(current.show().invisible());_resetView()}}});wrap.bind("onShow",function(){current.visible().hide().fadeIn();close.fadeIn();R.ajaxLoader.hide(loader);isLoading=false;isOpened=true;L.trigger("afterShow")})}this.initialize=function(options,setClick,el){elements=el;if(typeof setClick!="undefined"&&setClick){elements.each(function(){if(!$(this).data("realtyna-lightbox-obj-opts")){$(this).data("realtyna-lightbox-obj-opts",$.extend(true,{},defaults,options));$(this).on("click.realtyna-lightbox",function(evn){if(!isLoading){evn.preventDefault();L.open($(this),evn)}})}})}return this};this.open=function(selector,opt){var _options=opt||{};elements=R.isQuery(selector)?selector:$(selector);self.initialize(_options,true,elements);return L.open(elements)};this.close=function(){if(isOpen){wrap.trigger("onReset");isOpen=false;isOpened=false;isLoading=false;L._beforeOpen=[];L._afterOpen=[];L._afterShow=[];L._afterClose=[];$(wrap).removeClass(fx.showBox+" "+opts.position);if(opts.position=="center"){$(wrap).addClass(fx.hideBox)}else if(opts.position=="right"){$(wrap).animate({marginleft:0},450)}$(overlay).fadeOut(600,function(){_EventsOff();$(this).remove();L.trigger("afterClose");$("html").removeClass(classes.lock);if(opts.reloadPage)location.reload()});return true}return false};this.on=function(evn,func){var eventName="_"+evn;if(L.hasOwnProperty(eventName)){L[eventName].push(func)}return true}};$._realtyna.lightbox=function(){var lbInstance;return{version:"1.9.6",init:function(element,options){if(!element)return false;if(!lbInstance){lbInstance=new $._realtyna.fn.lightbox;this.open=lbInstance.open;this.on=lbInstance.on;this.close=lbInstance.close}return lbInstance.initialize(options,true,element)},initObject:function(){if(!lbInstance){lbInstance=new $._realtyna.fn.lightbox;this.open=lbInstance.open;this.on=lbInstance.on;this.close=lbInstance.close}return lbInstance},open:null,on:null,close:null}}()})(jQuery,window,document);